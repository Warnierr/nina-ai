# Configuration Assistant IA Vocal Nina - Type Jarvis
# Guide d'installation et configuration complÃ¨te

# Ce fichier contient les instructions pour crÃ©er un assistant IA vocal
# semblable Ã  Jarvis, capable d'Ã©couter et rÃ©pondre aux commandes vocales

## ğŸ–¥ï¸ 1. PrÃ©requis matÃ©riels et systÃ¨me
- âœ… PC avec au moins 16 Go de RAM
- âœ… Microphone fonctionnel (USB ou jack)
- âœ… Haut-parleurs ou casque
- âœ… OS Linux (Ubuntu 20.04+ recommandÃ©) ou Windows WSL2
- âœ… Python 3.10+ installÃ©
- âœ… Git et FFmpeg installÃ©s

### Test du microphone :
```bash
arecord -d 3 test.wav && aplay test.wav
```

## ğŸ› ï¸ 2. Configuration de l'environnement

### CrÃ©er le projet :
```bash
mkdir nina_assistant && cd nina_assistant
```

### Environnement virtuel :
```bash
python3 -m venv env
source env/bin/activate  # Linux/Mac
# ou env\Scripts\activate  # Windows
```

### Mise Ã  jour pip :
```bash
pip install --upgrade pip
```

## ğŸ§  3. Installation des composants IA

### Reconnaissance vocale (Whisper) :
```bash
pip install git+https://github.com/openai/whisper.git
```

### ModÃ¨le de langage local (GPT4All) :
```bash
pip install gpt4all
```

### SynthÃ¨se vocale (Coqui TTS) :
```bash
pip install TTS
```

### BibliothÃ¨ques audio et utilitaires :
```bash
pip install sounddevice soundfile numpy scipy
pip install requests beautifulsoup4 wikipedia-api
pip install python-dotenv schedule
sudo apt install libportaudio2  # Linux uniquement
```

### TÃ©lÃ©chargement du modÃ¨le :
```bash
mkdir models && cd models
wget https://gpt4all.io/models/ggml-gpt4all-j-v1.3-groovy.bin
cd ..
```

## ğŸ“ 4. Structure du projet

```
nina_assistant/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ ggml-gpt4all-j-v1.3-groovy.bin
â”œâ”€â”€ temp_audio/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ speech_recognition.py
â”‚   â”œâ”€â”€ text_processing.py
â”‚   â”œâ”€â”€ voice_synthesis.py
â”‚   â””â”€â”€ ai_brain.py
â”œâ”€â”€ nina.py
â””â”€â”€ requirements.txt
```

## ğŸ§¾ 5. Code principal nina.py

```python
import os
import sys
import json
import time
import threading
from datetime import datetime
import whisper
from gpt4all import GPT4All
from TTS.api import TTS
import sounddevice as sd
import soundfile as sf
import numpy as np

class NinaAssistant:
    def __init__(self):
        print("ğŸ¤– Nina s'initialise... Veuillez patienter")
        
        # Configuration
        self.setup_directories()
        self.load_models()
        self.setup_audio()
        
        # Ã‰tat de l'assistant
        self.is_listening = False
        self.wake_word = "nina"
        self.conversation_history = []
        
        print("âœ… Nina est prÃªte ! Dites 'Nina' pour commencer.")
    
    def setup_directories(self):
        """CrÃ©er les dossiers nÃ©cessaires"""
        os.makedirs("temp_audio", exist_ok=True)
        os.makedirs("logs", exist_ok=True)
    
    def load_models(self):
        """Charger tous les modÃ¨les IA"""
        print("ğŸ§  Chargement des modÃ¨les IA...")
        
        # Reconnaissance vocale
        self.whisper_model = whisper.load_model("base")
        
        # ModÃ¨le de langage
        self.gpt_model = GPT4All("ggml-gpt4all-j-v1.3-groovy.bin", model_path="./models")
        
        # SynthÃ¨se vocale
        self.tts = TTS(model_name="tts_models/fr/css10/vits", progress_bar=False, gpu=False)
        
        print("âœ… ModÃ¨les chargÃ©s avec succÃ¨s")
    
    def setup_audio(self):
        """Configuration audio"""
        self.sample_rate = 16000
        self.audio_duration = 5
    
    def record_audio(self, filename="temp_audio/input.wav", duration=None):
        """Enregistrer l'audio du microphone"""
        if duration is None:
            duration = self.audio_duration
            
        print("ğŸ™ï¸ Ã‰coute en cours...")
        
        try:
            audio = sd.rec(int(duration * self.sample_rate), 
                          samplerate=self.sample_rate, 
                          channels=1, dtype='float64')
            sd.wait()
            sf.write(filename, audio, self.sample_rate)
            return filename
        except Exception as e:
            print(f"âŒ Erreur d'enregistrement: {e}")
            return None
    
    def speech_to_text(self, audio_file):
        """Convertir l'audio en texte"""
        try:
            result = self.whisper_model.transcribe(audio_file)
            return result["text"].strip()
        except Exception as e:
            print(f"âŒ Erreur de transcription: {e}")
            return ""
    
    def process_command(self, text):
        """Traiter la commande et gÃ©nÃ©rer une rÃ©ponse"""
        if not text:
            return "Je n'ai pas bien entendu, pouvez-vous rÃ©pÃ©ter ?"
        
        # Ajouter le contexte de la conversation
        context = f"Tu es Nina, un assistant IA vocal franÃ§ais comme Jarvis. "
        context += f"RÃ©ponds de maniÃ¨re naturelle et utile. "
        context += f"Historique rÃ©cent: {' '.join(self.conversation_history[-3:])}"
        
        prompt = f"{context}\n\nUtilisateur: {text}\nNina:"
        
        try:
            response = self.gpt_model.generate(prompt, max_tokens=150, temp=0.7)
            
            # Nettoyer la rÃ©ponse
            response = response.strip()
            if response.startswith("Nina:"):
                response = response[5:].strip()
            
            return response
        except Exception as e:
            print(f"âŒ Erreur de gÃ©nÃ©ration: {e}")
            return "Je rencontre un problÃ¨me technique, excusez-moi."
    
    def text_to_speech(self, text, filename="temp_audio/response.wav"):
        """Convertir le texte en parole"""
        try:
            self.tts.tts_to_file(text=text, file_path=filename)
            return filename
        except Exception as e:
            print(f"âŒ Erreur de synthÃ¨se: {e}")
            return None
    
    def play_audio(self, filename):
        """Jouer un fichier audio"""
        try:
            if os.name == 'nt':  # Windows
                os.system(f'start /wait {filename}')
            else:  # Linux/Mac
                os.system(f'aplay {filename}')
        except Exception as e:
            print(f"âŒ Erreur de lecture: {e}")
    
    def detect_wake_word(self, text):
        """DÃ©tecter le mot de rÃ©veil"""
        return self.wake_word.lower() in text.lower()
    
    def log_conversation(self, user_input, ai_response):
        """Enregistrer la conversation"""
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        log_entry = {
            "timestamp": timestamp,
            "user": user_input,
            "nina": ai_response
        }
        
        # Sauvegarder dans l'historique
        self.conversation_history.append(f"User: {user_input} | Nina: {ai_response}")
        
        # Limiter l'historique
        if len(self.conversation_history) > 10:
            self.conversation_history.pop(0)
    
    def run(self):
        """Boucle principale de l'assistant"""
        print("ğŸš€ Nina est en fonctionnement !")
        print("ğŸ’¡ Dites 'Nina' suivi de votre question")
        print("ğŸ’¡ Dites 'Nina arrÃªt' pour quitter")
        
        while True:
            try:
                # Enregistrer l'audio
                audio_file = self.record_audio()
                if not audio_file:
                    continue
                
                # Convertir en texte
                user_text = self.speech_to_text(audio_file)
                if not user_text:
                    continue
                
                print(f"ğŸ—¨ï¸ Vous: {user_text}")
                
                # VÃ©rifier le mot de rÃ©veil
                if self.detect_wake_word(user_text):
                    # VÃ©rifier si c'est un arrÃªt
                    if "arrÃªt" in user_text.lower() or "stop" in user_text.lower():
                        print("ğŸ‘‹ Nina s'arrÃªte. Ã€ bientÃ´t !")
                        break
                    
                    # Traiter la commande
                    response = self.process_command(user_text)
                    print(f"ğŸ¤– Nina: {response}")
                    
                    # Convertir en audio et jouer
                    audio_response = self.text_to_speech(response)
                    if audio_response:
                        self.play_audio(audio_response)
                    
                    # Enregistrer la conversation
                    self.log_conversation(user_text, response)
                
                # Petit dÃ©lai pour Ã©viter la surcharge
                time.sleep(0.5)
                
            except KeyboardInterrupt:
                print("\nğŸ‘‹ Nina s'arrÃªte. Ã€ bientÃ´t !")
                break
            except Exception as e:
                print(f"âŒ Erreur inattendue: {e}")
                continue

# Point d'entrÃ©e
if __name__ == "__main__":
    try:
        nina = NinaAssistant()
        nina.run()
    except Exception as e:
        print(f"âŒ Erreur fatale: {e}")
        sys.exit(1)

## ğŸš€ 6. Lancement de Nina

### Activer l'environnement :
```bash
source env/bin/activate
```

### Lancer l'assistant :
```bash
python nina.py
```

## ğŸ”’ 7. FonctionnalitÃ©s avancÃ©es (optionnelles)

### DÃ©tection de mots-clÃ©s amÃ©liorÃ©e :
```bash
pip install pvporcupine  # Wake word detection
```

### IntÃ©gration domotique :
```bash
pip install paho-mqtt  # Pour IoT/domotique
```

### Reconnaissance d'Ã©motions :
```bash
pip install speechemotionrecognition
```

## ğŸ›¡ï¸ 8. SÃ©curitÃ© et vie privÃ©e

- âœ… Tout fonctionne hors ligne (pas de donnÃ©es envoyÃ©es sur internet)
- âœ… Logs locaux uniquement
- âœ… Suppression automatique des fichiers audio temporaires
- âœ… Chiffrement des donnÃ©es personnelles (si configurÃ©)

## ğŸ§ª 9. Tests recommandÃ©s

1. **Test de base** : "Nina, bonjour"
2. **Test de conversation** : "Nina, raconte-moi une blague"
3. **Test de commandes** : "Nina, quelle heure est-il ?"
4. **Test d'arrÃªt** : "Nina arrÃªt"

## ğŸ“š 10. AmÃ©liorations possibles

- ğŸ”„ DÃ©tection continue du wake word
- ğŸŒ IntÃ©gration d'APIs externes (mÃ©tÃ©o, actualitÃ©s)
- ğŸ  ContrÃ´le de la domotique
- ğŸ“± Interface mobile
- ğŸ§  Apprentissage personnalisÃ©
- ğŸ¯ Commandes vocales spÃ©cialisÃ©es 